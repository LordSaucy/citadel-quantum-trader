# ==============================================================
# Citadel Quantum Trader â€“ Global configuration file
# ==============================================================

# -----------------------------------------------------------------
# 1ï¸âƒ£  Global switches
# -----------------------------------------------------------------
use_shadow_mode: true          # true â†’ log signals only, never send real orders
scorer_mode: lightgbm          # "lightgbm" (default) or "linear" fallback

# -----------------------------------------------------------------
# 2ï¸âƒ£  Guard configuration â€“ thresholds that can be tweaked
# -----------------------------------------------------------------
guards:
  # ---- Sentiment guard -------------------------------------------------
  sentiment:
    guard_enabled: true
    positive_threshold: 0.30   # > 0.30 â†’ reject (overâ€‘optimistic)
    negative_threshold: -0.30  # < -0.30 â†’ reject (overâ€‘pessimistic)

  # ---- Calendar (highâ€‘impact event) guard ------------------------------
  calendar:
    lockout_enabled: true
    lockout_margin_minutes: 30   # minutes before/after a highâ€‘impact event

  # ---- Volatilityâ€‘spike guard -----------------------------------------
  volatility_spike:
    enabled: true
    atr_multiplier: 2.0           # current ATR > baseline * 2 â†’ reject
    baseline_atr: 0.0005          # dailyâ€‘computed baseline ATR (reloadable)

  # ---- Shockâ€‘detector guard -------------------------------------------
  shock_detector:
    enabled: true
    spread_multiplier: 3.0        # current spread > 3Ã— avg spread â†’ reject
    max_tick_age_secs: 2          # quote older than 2â€¯s â†’ reject
    lir_threshold: 0.6            # LIR > 0.6 â†’ reject
    min_depth: 0.02               # minimum depth as fraction of lot size

# -----------------------------------------------------------------
# 3ï¸âƒ£  Venues â€“ ordered list the engine will query
# -----------------------------------------------------------------
venues:
  - name: mt5_demo
    type: mt5
    vault_path: secret/data/citadel/brokers/mt5_demo
  - name: ibkr_demo
    type: ibkr
    vault_path: secret/data/citadel/brokers/ibkr_demo

# -----------------------------------------------------------------
# 4ï¸âƒ£  Depthâ€‘check parameters (used by the depthâ€‘guard)
# -----------------------------------------------------------------
min_depth_multiplier: 2.0   # required depth = multiplier Ã— lotâ€‘size

# -----------------------------------------------------------------
# 5ï¸âƒ£  Shockâ€‘Detector & Newsâ€‘Sentiment overlay
# -----------------------------------------------------------------
risk_shocks:
  # Sentiment score band â€“ trades outside this band are blocked
  sentiment:
    low:  -0.20   # very bearish â†’ block
    high:  0.20   # very bullish â†’ block (optional)

  # Macroâ€‘calendar â€“ minutes before/after a scheduled event
  macro_window_minutes: 30

  # Volatility spike â€“ ATR multiplier over its 30â€‘day EMA
  atr_spike_multiplier: 2.0

  # Sudden price jump â€“ % move in the last N minutes
  price_jump:
    window_minutes: 5
    threshold_pct: 1.5   # >1.5â€¯% move in 5â€¯min â†’ block

  # Edgeâ€‘decay â€“ winâ€‘rate floor (fallback if live winâ€‘rate unavailable)
  winrate_floor: 0.95

# -----------------------------------------------------------------
# 6ï¸âƒ£  Brokerâ€‘specific margin parameters (optional overrides)
# -----------------------------------------------------------------
broker:
  contract_notional: 100000   # $ per standard lot (e.g., 1 lot = $100k)
  max_leverage: 100           # brokerâ€‘declared max leverage (1:100)
  margin_factor: 0.01         # derived: 1â€¯% of notional per 1:100 leverage
  # If your broker gives a direct marginâ€‘perâ€‘lot value, uncomment:
  # margin_per_lot: 1000      # $ required to open 1 lot

# -----------------------------------------------------------------
# 7ï¸âƒ£  Monteâ€‘Carlo drawâ€‘down settings (used for killâ€‘switch)
# -----------------------------------------------------------------
monte_carlo_dd:
  dd_threshold: 0.05          # 5â€¯% drawâ€‘down at 99.9â€¯% percentile â†’ killâ€‘switch
  num_paths: 20000            # Monteâ€‘Carlo simulation paths per run
  trades_per_path: 1000       # Length of each simulated equity curve
  win_rate_override: null      # If you want a static winâ€‘rate, set a float (e.g. 0.997)
  rr_target: 5.0               # Rewardâ€‘toâ€‘risk ratio (must match bot config)

# -----------------------------------------------------------------
# 8ï¸âƒ£  Schedule â€“ riskâ€‘allocation per bucket (you can also store this in DB)
# -----------------------------------------------------------------
schedule:
  1: 1.00
  2: 1.00
  3: 0.60
  4: 0.50
  5: 0.40
  default: 0.40

# -----------------------------------------------------------------
# 9ï¸âƒ£  Optimiser â€“ weights for the confluence score
# -----------------------------------------------------------------
optimiser:
  weights:
    # Existing weights (examples â€“ keep your current values)
    mtf_alignment: 0.12
    head_and_shoulders: 0.08
    # NEW â€“ liquidity related
    lir: 0.15               # LIR contributes 15â€¯% of total confluence score
    depth: 0.05             # Small positive weight for sheer market depth
    # â€¦ add any other feature weights you already use â€¦

# -----------------------------------------------------------------
# ğŸ”Ÿ  Signalâ€‘layer specific thresholds
# -----------------------------------------------------------------
signal:
  lir_min_abs: 0.30          # Minimum absolute LIR required for a trade
  depth_min_units: 20000     # Minimum total depth (bidâ€¯+â€¯ask) in contract units

# -----------------------------------------------------------------
# 11ï¸âƒ£  Multiâ€‘broker routing (fallback logic)
# -----------------------------------------------------------------
multi_broker:
  primary: mt5
  secondary: ibkr
  latency_threshold_seconds: 0.20   # 200â€¯ms â€“ if primary exceeds, fallback to secondary
  fallback_enabled: true

# -----------------------------------------------------------------
# 12ï¸âƒ£  Riskâ€‘schedule (alternative schedules â€“ you can switch at runtime)
# -----------------------------------------------------------------
risk_schedule:
  normal:
    1: 1.00
    2: 1.00
    3: 0.60
    4: 0.50
    5: 0.40
  defensive:
    1: 0.50
    2: 0.50
    3: 0.30
    4: 0.25
    5: 0.20

# -----------------------------------------------------------------
# 13ï¸âƒ£  Feature parameters (used by various calculators)
# -----------------------------------------------------------------
features:
  atr_stop:
    k_range: [1.0, 2.5]      # optimiser will search inside this range
    period: 14
  vwap_bias:
    window_minutes: 30
  fractal_swings:
    lookback: 10
  time_of_day_decay:
    london_peak_start: "08:00"   # EST
    london_peak_end:   "12:00"
  regime_weights:
    trend:   "weights_trend.json"
    range:   "weights_range.json"
    high_vol:"weights_highvol.json"
  order_flow_delta:
    lookback_ticks: 200
  scorer:
    ensemble_weights:
      linear: 0.6
      tree:   0.4
    # Paths to the model files
    linear_weights_path: "models/linear_weights.json"
    tree_model_path:     "models/tree_scorer.bin"
    tree_feature_order:  "models/tree_feature_order.json"

# -----------------------------------------------------------------
# 14ï¸âƒ£  Baseline portfolio risk parameters
# -----------------------------------------------------------------
baseline_portfolio_atr: 0.005   # 0.5â€¯% of equity (tune after first week)
max_drawdown_cap: 0.20          # static cap = 20â€¯%

# -----------------------------------------------------------------
# 15ï¸âƒ£  Eventâ€‘window configuration (used by calendarâ€‘based filters)
# -----------------------------------------------------------------
event_window:
  pre_minutes: 5               # minutes BEFORE the event timestamp
  post_minutes: 15             # minutes AFTER the event timestamp
  impact_bias:
    high:   0.07
    medium: 0.04
    low:    0.02


