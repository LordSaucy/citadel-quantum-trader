# In config_watcher()
def reload_config():
    # 1️⃣ Pause new signal processing
    from src.trading_engine import signal_queue
    signal_queue.pause()          # implementation depends on your engine
    # 2️⃣ Swap files & reload
    if os.path.isfile(NEW_CONFIG_PATH):
        os.replace(NEW_CONFIG_PATH, CONFIG_PATH)
        from config_loader import Config
        Config()._load()
    # 3️⃣ Un‑pause after a short debounce
    time.sleep(0.5)               # give the engine a moment to settle
    signal_queue.resume()

    use_shadow_mode: true   # when true, bot logs signals but never sends orders

scorer_mode: lightgbm   # or "linear" to fall back

# -------------------------------------------------
# Guard configuration – tweak thresholds without rebuilding
# -------------------------------------------------
guards:
  sentiment:
    guard_enabled: true
    positive_threshold: 0.30   # >0.30 → reject (over‑optimistic)
    negative_threshold: -0.30  # <-0.30 → reject (over‑pessimistic)

  calendar:
    lockout_enabled: true
    lockout_margin_minutes: 30   # minutes before/after a high‑impact event

  volatility_spike:
    enabled: true
    atr_multiplier: 2.0          # current ATR > baseline * 2 → reject
    baseline_atr: 0.0005          # you can compute this daily and reload

  shock_detector:
    enabled: true
    spread_multiplier: 3.0       # current spread > 3× avg spread → reject
    max_tick_age_secs: 2         # quote older than 2 s → reject
    lir_threshold: 0.6           # LIR > 0.6 → reject
    min_depth: 0.02              # minimum depth as fraction of lot size

# -------------------------------------------------
# Guard parameters – keep this section up‑to‑date
# -------------------------------------------------
guards:
  # (as shown earlier)

  # -----------------------------------------------------------------
# Venues (ordered list – the engine will query them in this order)
# -----------------------------------------------------------------
venues:
  - name: mt5_demo
    type: mt5
    vault_path: secret/data/citadel/brokers/mt5_demo
  - name: ibkr_demo
    type: ibkr
    vault_path: secret/data/citadel/brokers/ibkr_demo

# -----------------------------------------------------------------
# Depth‑check parameters
# -----------------------------------------------------------------
min_depth_multiplier: 2.0   # required depth = multiplier × lot‑size

# -------------------------------------------------
# Shock‑Detector & News‑Sentiment overlay
# -------------------------------------------------
risk_shocks:
  # Sentiment score outside this band will block the trade
  sentiment:
    low: -0.2   # very bearish → block
    high:  0.2   # very bullish → block (optional)

  # Macro‑calendar – number of minutes before/after a scheduled event
  macro_window_minutes: 30

  # Volatility spike – ATR multiplier over its 30‑day EMA
  atr_spike_multiplier: 2.0   # e.g., ATR > 2× EMA(30d) → block

  # Sudden price jump – % move in the last N minutes
  price_jump:
    window_minutes: 5
    threshold_pct: 1.5   # >1.5 % move in 5 min → block

  # Edge‑decay – win‑rate floor (already exists, but we expose it here)
  winrate_floor: 0.95

  # -------------------------------------------------
# Broker‑specific margin parameters (optional overrides)
# -------------------------------------------------
broker:
  contract_notional: 100000      # $ per standard lot (e.g., 1 lot = $100k)
  max_leverage: 100              # broker‑declared max leverage (e.g., 1:100)
  margin_factor: 0.01            # 1 % of notional per 1:100 leverage (derived from above)
  # If your broker gives a direct “margin per lot” value, set it here:
  # margin_per_lot: 1000          # $ required to open 1 lot



